<UserControl x:Class="QuizCraft.Presentation.Views.ReviewView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
             xmlns:converters="clr-namespace:QuizCraft.Presentation.Converters">
    <UserControl.Resources>
        <converters:MasteryLevelToTextConverter x:Key="MasteryConv" />
        <converters:BoolToVisibilityConverter x:Key="BoolToVis" />
    </UserControl.Resources>

    <StackPanel>
        <TextBlock Text="Fila de Revisão" Style="{StaticResource PageTitle}" />

        <!-- Summary -->
        <UniformGrid Columns="3" Margin="0,0,0,16">
            <Border Style="{StaticResource CardBorder}" Margin="0,0,8,0">
                <StackPanel HorizontalAlignment="Center">
                    <TextBlock Text="{Binding DueToday}" Style="{StaticResource StatValue}" Foreground="#2196F3" />
                    <TextBlock Text="Para Revisar Hoje" Style="{StaticResource StatLabel}" />
                </StackPanel>
            </Border>
            <Border Style="{StaticResource CardBorder}" Margin="4,0">
                <StackPanel HorizontalAlignment="Center">
                    <TextBlock Text="{Binding Overdue}" Style="{StaticResource StatValue}" Foreground="#F44336" />
                    <TextBlock Text="Atrasadas" Style="{StaticResource StatLabel}" />
                </StackPanel>
            </Border>
            <Border Style="{StaticResource CardBorder}" Margin="8,0,0,0">
                <StackPanel HorizontalAlignment="Center">
                    <TextBlock Text="{Binding ReviewQueue.Count}" Style="{StaticResource StatValue}" />
                    <TextBlock Text="Na Fila" Style="{StaticResource StatLabel}" />
                </StackPanel>
            </Border>
        </UniformGrid>

        <!-- Filter -->
        <Grid Margin="0,0,0,12">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="200" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>
            <ComboBox ItemsSource="{Binding Subjects}" SelectedItem="{Binding FilterSubject}"
                      DisplayMemberPath="Name" ToolTip="Filtrar por matéria" />
            <ui:Button Grid.Column="1" Content="Atualizar" Command="{Binding LoadReviewQueueCommand}"
                       Margin="8,0,0,0" />
        </Grid>

        <!-- Review Queue List -->
        <ItemsControl ItemsSource="{Binding ReviewQueue}">
            <ItemsControl.ItemTemplate>
                <DataTemplate>
                    <Border Style="{StaticResource CardBorder}" Margin="0,0,0,4">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="120" />
                                <ColumnDefinition Width="100" />
                                <ColumnDefinition Width="100" />
                            </Grid.ColumnDefinitions>
                            <StackPanel>
                                <TextBlock Text="{Binding Statement}" TextTrimming="CharacterEllipsis" FontWeight="SemiBold" />
                                <TextBlock FontSize="11" Opacity="0.6">
                                    <Run Text="{Binding SubjectName, Mode=OneWay}" />
                                    <Run Text=" › " />
                                    <Run Text="{Binding TopicName, Mode=OneWay}" />
                                </TextBlock>
                            </StackPanel>
                            <TextBlock Grid.Column="1" Text="{Binding MasteryLevel, Converter={StaticResource MasteryConv}}"
                                       VerticalAlignment="Center" HorizontalAlignment="Center" />
                            <TextBlock Grid.Column="2" Text="{Binding NextReviewAt, StringFormat=dd/MM}"
                                       VerticalAlignment="Center" HorizontalAlignment="Center" />
                            <Border Grid.Column="3" CornerRadius="4" Padding="6,2" VerticalAlignment="Center"
                                    HorizontalAlignment="Center"
                                    Visibility="{Binding IsOverdue, Converter={StaticResource BoolToVis}}">
                                <Border.Background>
                                    <SolidColorBrush Color="#F44336" Opacity="0.15" />
                                </Border.Background>
                                <TextBlock Text="Atrasada" Foreground="#F44336" FontSize="11" FontWeight="SemiBold" />
                            </Border>
                        </Grid>
                    </Border>
                </DataTemplate>
            </ItemsControl.ItemTemplate>
        </ItemsControl>

        <TextBlock Text="Nenhuma questão para revisar. Continue estudando!"
                   HorizontalAlignment="Center" Opacity="0.5" Margin="0,24"
                   FontSize="14" />
    </StackPanel>
</UserControl>
