<UserControl x:Class="QuizCraft.Presentation.Views.ResultsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
             xmlns:converters="clr-namespace:QuizCraft.Presentation.Converters">
    <UserControl.Resources>
        <converters:DoubleToPercentageConverter x:Key="PctConverter" />
        <converters:PercentageToColorConverter x:Key="PctColorConverter" />
        <converters:BoolToCorrectTextConverter x:Key="CorrectTextConv" />
        <converters:BoolToCorrectColorConverter x:Key="CorrectColorConv" />
        <converters:BoolToVisibilityConverter x:Key="BoolToVis" />
    </UserControl.Resources>

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel MaxWidth="900" HorizontalAlignment="Center">
            <TextBlock Text="Resultado do Quiz" Style="{StaticResource PageTitle}" />

            <!-- Summary Cards -->
            <UniformGrid Columns="4" Margin="0,0,0,16">
                <Border Style="{StaticResource CardBorder}" Margin="0,0,8,0">
                    <StackPanel HorizontalAlignment="Center">
                        <TextBlock Text="{Binding AccuracyRate, Converter={StaticResource PctConverter}}"
                                   Style="{StaticResource StatValue}"
                                   Foreground="{Binding AccuracyRate, Converter={StaticResource PctColorConverter}}" />
                        <TextBlock Text="Taxa de Acerto" Style="{StaticResource StatLabel}" />
                    </StackPanel>
                </Border>
                <Border Style="{StaticResource CardBorder}" Margin="4,0">
                    <StackPanel HorizontalAlignment="Center">
                        <TextBlock Style="{StaticResource StatValue}" Foreground="#4CAF50">
                            <Run Text="{Binding CorrectCount, Mode=OneWay}" />
                            <Run Text="/" />
                            <Run Text="{Binding TotalQuestions, Mode=OneWay}" />
                        </TextBlock>
                        <TextBlock Text="Acertos" Style="{StaticResource StatLabel}" />
                    </StackPanel>
                </Border>
                <Border Style="{StaticResource CardBorder}" Margin="4,0">
                    <StackPanel HorizontalAlignment="Center">
                        <TextBlock Text="{Binding Duration}" Style="{StaticResource StatValue}" />
                        <TextBlock Text="Duração" Style="{StaticResource StatLabel}" />
                    </StackPanel>
                </Border>
                <Border Style="{StaticResource CardBorder}" Margin="8,0,0,0">
                    <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                        <Grid Width="60" Height="60">
                            <Ellipse Stroke="#E0E0E0" StrokeThickness="8" />
                            <Ellipse Stroke="#4CAF50" StrokeThickness="8"
                                     StrokeDashArray="100" StrokeDashOffset="0">
                            </Ellipse>
                        </Grid>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,6,0,0">
                            <Rectangle Width="10" Height="10" Fill="#4CAF50" RadiusX="2" RadiusY="2" Margin="0,0,4,0" />
                            <TextBlock FontSize="11">
                                <Run Text="{Binding CorrectCount, Mode=OneWay}" />
                                <Run Text=" Acertos" />
                            </TextBlock>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,2,0,0">
                            <Rectangle Width="10" Height="10" Fill="#F44336" RadiusX="2" RadiusY="2" Margin="0,0,4,0" />
                            <TextBlock FontSize="11">
                                <Run Text="{Binding IncorrectCount, Mode=OneWay}" />
                                <Run Text=" Erros" />
                            </TextBlock>
                        </StackPanel>
                    </StackPanel>
                </Border>
            </UniformGrid>

            <!-- Topic Breakdown -->
            <Border Style="{StaticResource CardBorder}" Margin="0,0,0,16">
                <StackPanel>
                    <TextBlock Text="Desempenho por Tópico" Style="{StaticResource SectionTitle}" />
                    <ItemsControl ItemsSource="{Binding TopicSummaries}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Grid Margin="0,4">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="80" />
                                        <ColumnDefinition Width="120" />
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="{Binding TopicName}" FontWeight="SemiBold" />
                                    <TextBlock Grid.Column="1" HorizontalAlignment="Center">
                                        <Run Text="{Binding Correct, Mode=OneWay}" />
                                        <Run Text="/" />
                                        <Run Text="{Binding Total, Mode=OneWay}" />
                                    </TextBlock>
                                    <ProgressBar Grid.Column="2" Value="{Binding AccuracyRate}" Maximum="100"
                                                 Height="8" VerticalAlignment="Center" />
                                </Grid>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </Border>

            <!-- Detailed Results -->
            <Border Style="{StaticResource CardBorder}">
                <StackPanel>
                    <TextBlock Text="Detalhes das Questões" Style="{StaticResource SectionTitle}" />
                    <ItemsControl ItemsSource="{Binding ResultItems}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Padding="8" Margin="0,0,0,4" CornerRadius="4"
                                        BorderThickness="0,0,0,1"
                                        BorderBrush="{ui:ThemeResource CardStrokeColorDefaultBrush}">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="40" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="80" />
                                            <ColumnDefinition Width="60" />
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Text="{Binding Number, StringFormat=#{0}}" FontWeight="SemiBold"
                                                   VerticalAlignment="Center" />
                                        <StackPanel Grid.Column="1">
                                            <TextBlock Text="{Binding Statement}" TextTrimming="CharacterEllipsis" />
                                            <TextBlock Text="{Binding TopicName}" FontSize="11" Opacity="0.5" />
                                        </StackPanel>
                                        <TextBlock Grid.Column="2"
                                                   Text="{Binding IsCorrect, Converter={StaticResource CorrectTextConv}}"
                                                   Foreground="{Binding IsCorrect, Converter={StaticResource CorrectColorConv}}"
                                                   FontWeight="SemiBold" VerticalAlignment="Center" />
                                        <TextBlock Grid.Column="3" Text="{Binding TimeSeconds, StringFormat={}{0}s}"
                                                   VerticalAlignment="Center" Opacity="0.6" />
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </Border>
        </StackPanel>
    </ScrollViewer>
</UserControl>
